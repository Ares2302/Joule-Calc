(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&l(s)}).observe(document,{childList:!0,subtree:!0});function i(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(o){if(o.ep)return;o.ep=!0;const a=i(o);fetch(o.href,a)}})();const Tt="/sounds/click.mp3",ot=document.getElementById("theme-switcher"),nt=document.getElementById("sun-icon"),at=document.getElementById("moon-icon"),it=document.getElementById("calcolaBtn"),st=document.getElementById("infoBtn"),lt=document.getElementById("closeInfoModalBtn"),$=document.getElementById("storico"),V=document.getElementById("peso"),J=document.getElementById("velocita"),Dt=document.getElementById("risultato");document.getElementById("avvisoStorico");const ct=document.getElementById("maxJouleInfo"),Nt=document.getElementById("maxJouleDetails"),rt=document.getElementById("clearHistoryBtn"),dt=document.getElementById("copyHistoryBtn"),ut=document.getElementById("shareHistoryBtn"),mt=document.getElementById("openHistoryModalBtn"),jt=document.getElementById("historyModal");document.getElementById("copyAllHistoryBtn");const q=document.getElementById("fullHistoryContent"),pt=document.getElementById("infoModal"),N=document.getElementById("messageModal"),Ht=document.getElementById("modalMessage"),R=document.getElementById("confirmationModal"),Ft=document.getElementById("confirmationModalMessage"),gt=document.getElementById("confirmYesBtn"),ft=document.getElementById("confirmNoBtn");document.getElementById("sectionHelpModal");document.getElementById("sectionHelpTitle");document.getElementById("sectionHelpContent");document.getElementById("closeSectionHelpModalBtn");const K=document.getElementById("tab-joule"),Q=document.getElementById("tab-velocity"),X=document.getElementById("panel-joule"),W=document.getElementById("panel-velocity"),Jt=document.getElementById("targetJoule"),Pt=document.getElementById("reversePeso"),ht=document.getElementById("calcolaVelocitaBtn"),_t=document.getElementById("risultatoVelocita"),j=document.getElementById("opticUnitSwitch"),Vt=document.getElementById("panels-container"),Z=document.getElementById("tab-compensation"),tt=document.getElementById("panel-compensation"),Rt=document.getElementById("moaDistance"),Gt=document.getElementById("moaDrop"),Ut=document.getElementById("moaDrift"),zt=document.getElementById("driftDirection"),yt=document.getElementById("calcolaMoaBtn"),G=document.getElementById("moaPerClick");document.getElementById("risultatoMoa");const vt=document.documentElement,wt=.06479891,Ct=.3048,Yt=50,B=10,kt="calcolatoreJouleStorico",qt={"1/4 MOA per Click":.25,"1/2 MOA per Click":.5,"1/8 MOA per Click":.125,"1 MOA per Click":1},Kt={"0.1 MRAD per Click":.1,"0.05 MRAD per Click":.05};let et=null;const Lt=t=>{t.classList.add("visible"),t.style.display="flex",t.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden"},U=t=>{t.classList.remove("visible"),t.style.display="none",t.setAttribute("aria-hidden","true"),document.body.style.overflow=""},Qt=(t,e)=>{Ft.textContent=t,et=e,Lt(R)},E=(t,e=!0)=>{Ht.textContent=t,N.classList.remove("bg-green-500","bg-red-500"),N.classList.add(e?"bg-green-500":"bg-red-500"),N.classList.add("show"),setTimeout(()=>{N.classList.remove("show")},3e3)};function Xt(){return et}function Et(){et=null}const Wt=t=>{const e=t==="imperiale",i=document.getElementById("labelPeso"),l=document.getElementById("labelVelocita"),o=document.getElementById("labelReversePeso");e?(i.textContent="Peso pallino (in grani)",l.textContent="Velocità (in fps)",o.textContent="Peso pallino (in grani)",V.placeholder="Esempio: 3.09",J.placeholder="Esempio: 326.4"):(i.textContent="Peso pallino (in grammi)",l.textContent="Velocità (in m/s)",o.textContent="Peso pallino (in grammi)",V.placeholder="Esempio: 0.20",J.placeholder="Esempio: 99.5")},Zt=t=>{t==="dark"?(vt.classList.add("dark"),nt.classList.add("hidden"),at.classList.remove("hidden")):(vt.classList.remove("dark"),nt.classList.remove("hidden"),at.classList.add("hidden"))},te=()=>window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",It=()=>localStorage.getItem("theme")||te(),bt=()=>{const e=j.checked?Kt:qt;G.innerHTML="";for(const[i,l]of Object.entries(e))G.add(new Option(i,l))};let y=[],H={},k={},I=B;function ee(){const t="history-animation-styles";if(document.getElementById(t))return;const e=document.createElement("style");e.id=t,e.innerHTML=`
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .history-item-animate {
            animation: fadeInDown 0.4s ease-out forwards;
        }
        @keyframes fadeOutAndShrink {
            to {
                opacity: 0;
                transform: scale(0.95);
                height: 0;
                padding-top: 0;
                padding-bottom: 0;
                margin-top: 0;
                margin-bottom: 0;
                border: 0;
            }
        }
        .history-item-deleting {
            overflow: hidden;
            animation: fadeOutAndShrink 0.4s ease-out forwards;
        }
        .history-list {
            transition: max-height 0.5s ease-in-out, opacity 0.5s ease-in-out;
            max-height: 1000px; /* Un valore abbastanza grande da contenere gli elementi */
            overflow: hidden;
            opacity: 1;
        }
        .history-list.collapsed {
            max-height: 0;
            opacity: 0;
        }
    `,document.head.appendChild(e)}ee();function oe(){return y}function ne(t){y.unshift(t),St()}function ae(){return y.length>=Yt}const ie=()=>{localStorage.setItem(kt,JSON.stringify(y))},se=()=>{const t=localStorage.getItem(kt);t&&(y=JSON.parse(t).map(e=>({...e,data:new Date(e.data)}))),I=B,M($,y,!0,!0),M(q,y,!1,!1)},le=()=>{Qt("Sei sicuro di voler cancellare tutto lo storico dei calcoli? Questa azione non può essere annullata.",()=>{y=[],H={},St(),E("Storico cancellato con successo!")})};function St(t=!0){t?I=B:I=Math.max(B,I-1);const e=new Set;if(t&&y.length>0&&e.add(y[0].id),t){const i=document.getElementById("history-scroll-container");i&&i.scrollTop>0&&i.scrollTo({top:0,behavior:"smooth"})}M($,y,!0,!0,{animatedItemIds:e}),M(q,y,!1,!1),ie()}function ce(t,e,i,l){const o=e.length,a=o-I;if(a<=0||I>=o)return;const s=Math.min(B,a),c=document.createElement("button");c.id="load-more-history",c.className="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition-colors duration-200",c.textContent=`Mostra altri ${s} (ne rimangono ${a})`,c.addEventListener("click",()=>{const f=I;I+=B;const b=new Set(e.slice(f,I).map(w=>w.id));M(t,e,i,l,{animatedItemIds:b})}),t.appendChild(c)}const M=(t=$,e=y,i=!0,l=!1,o={})=>{const{animatedItemIds:a=new Set}=o;if(t.innerHTML="",e.length===0){t.innerHTML='<div class="text-center text-gray-500 dark:text-gray-400 py-10">Lo storico dei calcoli apparirà qui.</div>',t===$&&ct.classList.add("hidden");return}const s=e.reduce((n,r)=>{const u=r.pesoOriginale.toFixed(2);return n[u]||(n[u]=[]),n[u].push(r),n},{}),c=Object.keys(s).sort((n,r)=>{const u=s[n].reduce((h,p)=>p.data>h?p.data:h,new Date(0));return s[r].reduce((h,p)=>p.data>h?p.data:h,new Date(0))-u}),f=c.flatMap(n=>{const r=s[n],u=H[n]||"recent",x=[...r];switch(u){case"recent":x.sort((h,p)=>p.data-h.data);break;case"oldest":x.sort((h,p)=>h.data-p.data);break;case"joule-desc":x.sort((h,p)=>p.joule-p.joule);break;case"joule-asc":x.sort((h,p)=>h.joule-p.joule);break}return x}),w=(l?f.slice(0,I):f).reduce((n,r)=>{const u=r.pesoOriginale.toFixed(2);return n[u]||(n[u]=[]),n[u].push(r),n},{});if(c.forEach(n=>{if(!w[n])return;let r=w[n];const u=H[n]||"recent",h=s[n].reduce((d,m)=>d+m.joule,0)/s[n].length,p=s[n][0].unita.split(" ")[0],L=document.createElement("div");L.className="history-group bg-gray-100 dark:bg-gray-700 p-4 rounded-lg shadow-sm",L.dataset.groupPeso=n;const C=document.createElement("div");C.className="flex flex-col sm:flex-row justify-between items-center mb-2 cursor-pointer",C.addEventListener("click",d=>{if(d.target.closest("select, button"))return;const m=`list-${n}-${t.id}`,g=document.getElementById(m),O=C.querySelector(".collapse-icon");g&&(k[n]=!k[n],g.classList.toggle("collapsed",k[n]),O&&(O.style.transform=k[n]?"rotate(-90deg)":"rotate(0deg)"))});const A=document.createElement("span");A.className="collapse-icon text-blue-800 dark:text-blue-200 transition-transform duration-300",A.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" /></svg>',A.style.transform=k[n]?"rotate(-90deg)":"rotate(0deg)";const T=document.createElement("div");T.className="flex items-center gap-2 bg-blue-200 text-blue-800 dark:bg-blue-900 dark:text-blue-200 text-sm font-bold p-2 rounded-md text-center mb-2 sm:mb-0 w-full sm:w-auto justify-between";const D=document.createElement("span");D.className="flex items-center gap-2",D.textContent=`Media Joule (${n} ${p}): ${h.toFixed(2)} J`,D.prepend(A),T.appendChild(D),C.appendChild(T);const P=document.createElement("div");if(P.className="flex items-center gap-2",s[n].length>1){const d=document.createElement("select");d.id=`sort-${n}`,d.setAttribute("data-peso",n),d.className="block pl-3 pr-8 py-1 text-xs border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 rounded-md",d.innerHTML=`
                <option value="recent" ${u==="recent"?"selected":""}>Più recente</option>
                <option value="oldest" ${u==="oldest"?"selected":""}>Meno recente</option>
                <option value="joule-desc" ${u==="joule-desc"?"selected":""}>Joule (Max)</option>
                <option value="joule-asc" ${u==="joule-asc"?"selected":""}>Joule (Min)</option>
            `,d.addEventListener("change",O=>{H[O.target.dataset.peso]=O.target.value,I=B,M(t,e,i,l)});const m=document.createElement("label");m.setAttribute("for",`sort-${n}`),m.className="text-sm text-gray-600 dark:text-gray-300",m.textContent="Ordina:";const g=document.createElement("div");g.className="flex items-center gap-2",g.appendChild(m),g.appendChild(d),P.appendChild(g)}if(i){const d=document.createElement("div");d.className="flex items-center";const m=document.createElement("button");m.className="text-blue-500 hover:text-blue-700 p-1 rounded-full transition-colors duration-200",m.setAttribute("data-action","copy-group"),m.setAttribute("data-peso",n),m.setAttribute("aria-label",`Copia tutti i calcoli per il peso ${n}`),m.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>',d.appendChild(m);const g=document.createElement("button");g.className="text-red-500 hover:text-red-700 p-1 rounded-full transition-colors duration-200 ml-1",g.setAttribute("data-action","delete-group"),g.setAttribute("data-peso",n),g.setAttribute("aria-label",`Elimina tutti i calcoli per il peso ${n}`),g.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>',d.appendChild(g),T.appendChild(d)}C.appendChild(P),L.appendChild(C);const S=document.createElement("div");S.id=`list-${n}-${t.id}`,S.className="history-list space-y-2 pt-2",k[n]&&S.classList.add("collapsed"),r.forEach(d=>{const m=document.createElement("div");m.className="history-item bg-gray-200 dark:bg-gray-600 p-3 rounded-md flex justify-between items-center",m.dataset.itemId=d.id,a.has(d.id)&&m.classList.add("history-item-animate");let g=i?`
                <button class="text-red-500 hover:text-red-700 p-1 rounded-full transition-colors duration-200" data-action="delete-single" data-id="${d.id}" aria-label="Elimina singolo calcolo">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>`:"";m.innerHTML=`
                <div>
                    <p class="text-sm font-medium dark:text-white">Joule: <span class="font-bold">${d.joule.toFixed(2)}</span></p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">${new Date(d.data).toLocaleString()}</p>
                </div>
                <div class="flex items-center gap-2">
                    <div class="text-right">
                        <p class="text-xs text-gray-700 dark:text-gray-300">Velocità: ${d.velocitaOriginale.toFixed(2)} ${d.unita.split(" ")[2]}</p>
                    </div>
                    ${g}
                </div>
            `,S.appendChild(m)}),L.appendChild(S),t.appendChild(L)}),l&&ce(t,f,i,l),t===$&&e.length>0){const n=Math.max(...e.map(u=>u.joule)),r=e.find(u=>u.joule===n);ct.classList.remove("hidden"),Nt.innerHTML=`
            <p>
                Il risultato più alto è di <span class="font-bold text-lg">${n.toFixed(2)} J</span>,
                ottenuto con un pallino da <span class="font-bold">${r.pesoOriginale.toFixed(2)} ${r.unita.split(" ")[0]}</span>
                e una velocità di <span class="font-bold">${r.velocitaOriginale.toFixed(2)} ${r.unita.split(" ")[2]}</span>.
            </p>
            <p class="text-xs text-gray-600 dark:text-gray-400 mt-2">Registrato il: ${new Date(r.data).toLocaleString()}</p>
        `}},Ot=()=>{const t=oe();if(t.length===0)return"Nessun calcolo nello storico da condividere.";let e=`I miei risultati:

`;const i=t.reduce((a,s)=>{const c=s.pesoOriginale.toFixed(2);return a[c]||(a[c]={unita:s.unita,calcoli:[]}),a[c].calcoli.push(s),a},{});Object.keys(i).sort((a,s)=>{const c=Math.max(...i[a].calcoli.map(b=>b.data.getTime()));return Math.max(...i[s].calcoli.map(b=>b.data.getTime()))-c}).forEach(a=>{const s=i[a],c=s.unita.split(" ")[0],f=s.unita.split(" ")[2],b=s.calcoli.reduce((n,r)=>n+r.joule,0)/s.calcoli.length;e+=`--- Peso: ${a} ${c} (Media: ${b.toFixed(2)} J) ---
`,[...s.calcoli].sort((n,r)=>r.data-n.data).forEach(n=>{const r=new Date(n.data),u=r.toLocaleDateString("it-IT"),x=r.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"});e+=`- ${u} ${x} | ${n.joule.toFixed(2)} J (${n.velocitaOriginale.toFixed(2)} ${f})
`}),e+=`
`});const o=t.reduce((a,s)=>s.joule>a.joule?s:a,t[0]);return e+=`--- Risultato Massimo ---
`,e+=`Il valore più alto registrato è ${o.joule.toFixed(2)} J con un pallino da ${o.pesoOriginale.toFixed(2)} ${o.unita.split(" ")[0]} a ${o.velocitaOriginale.toFixed(2)} ${o.unita.split(" ")[2]}.
`,e},re=t=>{navigator.clipboard.writeText(t).then(()=>{E("Storico copiato negli appunti!")}).catch(()=>{E("Errore durante la copia. Prova a selezionare e copiare manualmente.",!1)})},de=t=>{const e=Ot()+`

---
Generato da Joule-Calc: https://joule-calc.web.app/`;navigator.share?navigator.share({title:"Storico Calcoli Joule",text:e}).then(()=>E("Storico condiviso con successo!")).catch(i=>{i.name!=="AbortError"&&E("Condivisione annullata o fallita.",!1)}):E('La condivisione non è supportata. Usa il tasto "Copia".',!1)};function ue(t,e,i){if(isNaN(t)||isNaN(e)||t<=0||e<=0)throw new Error("Valori di input non validi.");return i&&(t=t*wt,e=e*Ct),.5*(t/1e3)*(e*e)}function me(t,e,i){if(isNaN(t)||isNaN(e)||t<=0||e<=0)throw new Error("Valori di input non validi.");let l;i?l=e*wt/1e3:l=e/1e3;const o=Math.sqrt(2*t/l),a=o/Ct;return{mps:o,fps:a}}function pe(t){const{isMrad:e,distance:i,drop:l,drift:o,clickValue:a}=t;if(isNaN(i)||i<=0||l<=0&&o<=0)throw new Error("Distanza o deviazione non valide.");const s=c=>{if(c<=0)return{value:0,clicks:0};let f;e?f=c/(i/10):f=c/i*100/2.9089;const b=f/a;return{value:f,clicks:b}};return{elevation:s(l),windage:s(o)}}let z=null;const $t=t=>{!t||z||(Lt(t),z=t,history.pushState({modalOpen:!0,modalId:t.id},""))},ge=(t,e=!1)=>{!t||t.style.display==="none"||(U(t),z=null,!e&&history.state&&history.state.modalOpen&&history.back())},F="jouleCalcUnitSystem",xt=t=>{Wt(t),localStorage.setItem(F,t),document.querySelectorAll("[data-unit-selector]").forEach(i=>{const l=i.querySelector('[data-unit-button="metrico"]'),o=i.querySelector('[data-unit-button="imperiale"]');l&&l.classList.toggle("active-unit",t==="metrico"),o&&o.classList.toggle("active-unit",t==="imperiale")})},Bt=t=>{Zt(t);const e=t==="dark"?"#111827":"#ffffff",i=document.querySelector('meta[name="theme-color"]');i&&i.setAttribute("content",e)},Y=new Audio(Tt);Y.preload="auto";const _=()=>{Y.currentTime=0,Y.play().catch(t=>console.warn("La riproduzione del suono non è riuscita:",t))},v=(t=10)=>{navigator&&"vibrate"in navigator&&navigator.vibrate(t)};document.addEventListener("DOMContentLoaded",()=>{Bt(It()),st&&st.addEventListener("click",()=>$t(pt)),lt&&lt.addEventListener("click",()=>ge(pt)),gt&&gt.addEventListener("click",()=>{v(20),U(R);const t=Xt();t&&t(),Et()}),ft&&ft.addEventListener("click",()=>{v(),U(R),Et()}),ot&&ot.addEventListener("click",()=>{v();const t=It()==="dark"?"light":"dark";localStorage.setItem("theme",t),Bt(t)}),document.getElementById("appContainer")&&fe()});function fe(){se();const t=()=>{const o=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${o}px`)};window.addEventListener("resize",t),t(),it&&it.addEventListener("click",()=>{v();try{const o=parseFloat(V.value),a=parseFloat(J.value),s=(localStorage.getItem(F)||"metrico")==="imperiale",c=ue(o,a,s);_(),Dt.innerHTML=`<span class="font-semibold">Energia in Joule:</span> <span id="joule-value" class="font-bold text-xl">${c.toFixed(2)}</span>`,ae()?E("Storico pieno! Calcolo non salvato.",!1):(ne({id:Date.now(),pesoOriginale:o,velocitaOriginale:a,unita:s?"gr e fps":"g e m/s",joule:c,data:new Date}),E("Calcolo salvato nello storico!")),J.value=""}catch{E("Dati non validi!",!1)}}),ht&&ht.addEventListener("click",()=>{v();try{const o=parseFloat(Jt.value),a=parseFloat(Pt.value),s=(localStorage.getItem(F)||"metrico")==="imperiale",{mps:c,fps:f}=me(o,a,s);_(),_t.innerHTML=`<p class="font-semibold">Velocità necessaria:</p><p><span class="font-bold text-xl">${c.toFixed(2)}</span> m/s</p><p><span class="font-bold text-xl">${f.toFixed(2)}</span> fps</p>`}catch{E("Dati non validi!",!1)}}),yt&&yt.addEventListener("click",()=>{v();try{const o={isMrad:j.checked,distance:parseFloat(Rt.value),drop:parseFloat(Gt.value)||0,drift:parseFloat(Ut.value)||0,dropDirection:document.getElementById("dropDirection").value,driftDirection:zt.value,clickValue:parseFloat(G.value)},{elevation:a,windage:s}=pe(o);_()}catch{E("Dati non validi!",!1)}}),document.body.addEventListener("click",o=>{const a=o.target.closest("[data-unit-button]");a&&(v(),xt(a.dataset.unitButton))});const e=[K,Q,Z],i=[X,W,tt];Vt&&e.forEach((o,a)=>{o&&o.addEventListener("click",()=>{v(),At(e[a],i[a])})}),rt&&rt.addEventListener("click",()=>{v(20),le()}),dt&&dt.addEventListener("click",()=>{v(),re(Ot())}),ut&&ut.addEventListener("click",()=>{v(),de()}),mt&&mt.addEventListener("click",()=>{M(q,void 0,!1),$t(jt)});const l=localStorage.getItem(F)||"metrico";xt(l),j&&(bt(),j.addEventListener("change",()=>{v(),bt()})),Mt(),window.addEventListener("hashchange",Mt)}function At(t,e){[K,Q,Z].forEach(i=>i.classList.remove("active")),t.classList.add("active"),[X,W,tt].forEach(i=>i.classList.add("hidden")),e.classList.remove("hidden")}function Mt(){const t=window.location.hash.substring(1),e={joule:{tab:K,panel:X},velocity:{tab:Q,panel:W},compensation:{tab:Z,panel:tt}};t&&e[t]&&At(e[t].tab,e[t].panel)}
