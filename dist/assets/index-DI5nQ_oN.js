(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))d(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&d(r)}).observe(document,{childList:!0,subtree:!0});function o(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function d(s){if(s.ep)return;s.ep=!0;const i=o(s);fetch(s.href,i)}})();const ye="/sounds/click.mp3",be=document.getElementById("theme-switcher"),Ut=document.getElementById("sun-icon"),Yt=document.getElementById("moon-icon"),dt=document.getElementById("calcolaBtn"),xe=document.getElementById("infoBtn"),Ee=document.getElementById("closeInfoModalBtn"),st=document.getElementById("storico"),U=document.getElementById("peso"),D=document.getElementById("velocita"),F=document.getElementById("risultato"),Gt=document.getElementById("avvisoStorico"),qt=document.getElementById("maxJouleInfo"),Le=document.getElementById("maxJouleDetails"),we=document.getElementById("clearHistoryBtn"),Ie=document.getElementById("copyHistoryBtn"),ke=document.getElementById("shareHistoryBtn"),Be=document.getElementById("openHistoryModalBtn"),ut=document.getElementById("historyModal");document.getElementById("copyAllHistoryBtn");const At=document.getElementById("fullHistoryContent"),Kt=document.getElementById("infoModal"),pt=document.getElementById("messageModal"),Me=document.getElementById("modalMessage"),kt=document.getElementById("confirmationModal"),Se=document.getElementById("confirmationModalMessage"),Ce=document.getElementById("confirmYesBtn"),Te=document.getElementById("confirmNoBtn"),Bt=document.getElementById("sectionHelpModal"),$e=document.getElementById("sectionHelpTitle"),Ae=document.getElementById("sectionHelpContent"),De=document.getElementById("closeSectionHelpModalBtn"),ft=document.getElementById("tab-joule"),Mt=document.getElementById("tab-velocity"),_=document.getElementById("panel-joule"),St=document.getElementById("panel-velocity"),mt=document.getElementById("targetJoule"),et=document.getElementById("reversePeso"),xt=document.getElementById("calcolaVelocitaBtn"),J=document.getElementById("risultatoVelocita"),vt=document.getElementById("opticUnitSwitch"),Xt=document.getElementById("panels-container"),Ct=document.getElementById("tab-compensation"),Tt=document.getElementById("panel-compensation"),gt=document.getElementById("moaDistance"),ot=document.getElementById("moaDrop"),nt=document.getElementById("moaDrift"),Oe=document.getElementById("driftDirection"),Et=document.getElementById("calcolaMoaBtn"),lt=document.getElementById("moaPerClick"),R=document.getElementById("risultatoMoa"),Zt=document.documentElement,ie=.06479891,se=.3048,He=50,G=10,le="calcolatoreJouleStorico",Ne={"1/4 MOA per Click":.25,"1/2 MOA per Click":.5,"1/8 MOA per Click":.125,"1 MOA per Click":1},je={"0.1 MRAD per Click":.1,"0.05 MRAD per Click":.05},Pe={joule:{title:"Aiuto: Calcolo Joule",content:`
            <p>Questa sezione calcola l'energia cinetica (in Joule) del pallino.</p>
            <ul class="list-disc list-inside space-y-2 mt-2">
                <li><strong>Peso pallino:</strong> Inserisci il peso del pallino. L'unità di misura (grammi o grani) dipende dal selettore Metrico/Imperiale in alto.</li>
                <li><strong>Velocità:</strong> Inserisci la velocità del pallino misurata con un cronografo. L'unità (m/s o fps) dipende dallo stesso selettore.</li>
                <li><strong>Calcola e Salva:</strong> Il pulsante calcola i Joule e aggiunge automaticamente il risultato allo storico sulla destra.</li>
            </ul>
        `},velocity:{title:"Aiuto: Calcolo Velocità",content:`
            <p>Questa sezione calcola la velocità teorica che un pallino deve avere per raggiungere un determinato valore di Joule.</p>
            <ul class="list-disc list-inside space-y-2 mt-2">
                <li><strong>Joule Desiderati:</strong> Inserisci il valore di energia che vuoi raggiungere (es. 0.99).</li>
                <li><strong>Peso pallino:</strong> Inserisci il peso del pallino che intendi usare.</li>
                <li>Il risultato mostrerà la velocità necessaria sia in metri al secondo (m/s) che in piedi al secondo (fps).</li>
            </ul>
        `},compensation:{title:"Aiuto: Compensazione Ottica",content:`
            <p>Questo strumento ti aiuta a tradurre la deviazione del colpo (osservata sul bersaglio) in "click" da applicare alle torrette della tua ottica.</p>
            <ul class="list-disc list-inside space-y-2 mt-2">
                <li><strong>Unità Ottica:</strong> Scegli se la tua ottica è in MOA (Minute of Angle) o MRAD (Milliradian).</li>
                <li><strong>Distanza al bersaglio:</strong> Inserisci la distanza in metri a cui stai sparando.</li>
                <li><strong>Caduta verticale (Alzo):</strong> Misura di quanti centimetri il pallino è caduto rispetto al punto mirato.</li>
                <li><strong>Spostamento orizzontale (Deriva):</strong> Misura di quanti centimetri il pallino si è spostato a destra o sinistra.</li>
                <li><strong>Valore per Click:</strong> Seleziona il valore di correzione per ogni click della tua ottica (es. 1/4 MOA).</li>
            </ul>
        `}};let Dt=null;const Ot=t=>{t.classList.add("visible"),t.style.display="flex",t.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden"},z=t=>{t.classList.remove("visible"),t.style.display="none",t.setAttribute("aria-hidden","true"),document.body.style.overflow=""},Ht=(t,e)=>{Se.textContent=t,Dt=e,Ot(kt)},x=(t,e=!0)=>{Me.textContent=t,pt.classList.remove("bg-green-500","bg-red-500"),pt.classList.add(e?"bg-green-500":"bg-red-500"),pt.classList.add("show"),setTimeout(()=>{pt.classList.remove("show")},3e3)},Fe=(t,e="Testo copiato negli appunti!")=>{navigator.clipboard.writeText(t).then(()=>{x(e)}).catch(()=>{x("Errore durante la copia. Prova a selezionare e copiare manualmente.",!1)})};function Je(){return Dt}function Qt(){Dt=null}const Re=t=>{const e=t==="imperiale",o=document.getElementById("labelPeso"),d=document.getElementById("labelVelocita"),s=document.getElementById("labelReversePeso");e?(o.textContent="Peso pallino (in grani)",d.textContent="Velocità (in fps)",s.textContent="Peso pallino (in grani)",U.placeholder="Esempio: 3.09",D.placeholder="Esempio: 326.4"):(o.textContent="Peso pallino (in grammi)",d.textContent="Velocità (in m/s)",s.textContent="Peso pallino (in grammi)",U.placeholder="Esempio: 0.20",D.placeholder="Esempio: 99.5")},Ve=t=>{t==="dark"?(Zt.classList.add("dark"),Ut.classList.add("hidden"),Yt.classList.remove("hidden")):(Zt.classList.remove("dark"),Ut.classList.remove("hidden"),Yt.classList.add("hidden"))},_e=()=>window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",Wt=()=>localStorage.getItem("theme")||_e(),te=()=>{const e=vt.checked?je:Ne;lt.innerHTML="";for(const[o,d]of Object.entries(e))lt.add(new Option(o,d))};function ze(t){const e=Pe[t];e&&($e.textContent=e.title,Ae.innerHTML=e.content,Ot(Bt))}const Ue=t=>{var i;const e=[ft,Mt,Ct],o={"tab-joule":{color:"indigo"},"tab-velocity":{color:"teal"},"tab-compensation":{color:"purple"}},d=["border-transparent","text-gray-500","hover:text-gray-700","hover:border-gray-300","dark:text-gray-400","dark:hover:text-gray-300","dark:hover:border-gray-500"];e.forEach(r=>{var u;const l=(u=o[r.id])==null?void 0:u.color;l&&(r.classList.remove(`border-${l}-500`,`text-${l}-600`,`dark:border-${l}-400`,`dark:text-${l}-400`),r.classList.remove("active")),r.classList.add(...d)});const s=(i=o[t.id])==null?void 0:i.color;s&&(t.classList.remove(...d),t.classList.add(`border-${s}-500`,`text-${s}-600`,`dark:border-${s}-400`,`dark:text-${s}-400`),t.classList.add("active"))};let k=[],rt={},Q={},T=G;function Ye(){const t="history-animation-styles";if(document.getElementById(t))return;const e=document.createElement("style");e.id=t,e.innerHTML=`
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .history-item-animate {
            animation: fadeInDown 0.4s ease-out forwards;
        }
        @keyframes fadeOutAndShrink {
            to {
                opacity: 0;
                transform: scale(0.95);
                height: 0;
                padding-top: 0;
                padding-bottom: 0;
                margin-top: 0;
                margin-bottom: 0;
                border: 0;
            }
        }
        .history-item-deleting {
            overflow: hidden;
            animation: fadeOutAndShrink 0.4s ease-out forwards;
        }
        .history-list {
            transition: max-height 0.5s ease-in-out, opacity 0.5s ease-in-out;
            max-height: 1000px; /* Un valore abbastanza grande da contenere gli elementi */
            overflow: hidden;
            opacity: 1;
        }
        .history-list.collapsed {
            max-height: 0;
            opacity: 0;
        }
    `,document.head.appendChild(e)}Ye();function Nt(){return k}function Ge(t){k.unshift(t),bt()}function qe(){return k.length>=He}const Ke=()=>{localStorage.setItem(le,JSON.stringify(k))},Xe=()=>{const t=localStorage.getItem(le);t&&(k=JSON.parse(t).map(e=>({...e,data:new Date(e.data)}))),T=G,q(st,k,!0,!0),q(At,k,!1,!1)},ee=()=>{Ht("Sei sicuro di voler cancellare tutto lo storico dei calcoli? Questa azione non può essere annullata.",()=>{k=[],rt={},bt(),x("Storico cancellato con successo!")})},Ze=t=>{Ht("Sei sicuro di voler eliminare questo calcolo?",()=>{const e=parseFloat(t),o=document.querySelector(`.history-item[data-item-id="${e}"]`),d=()=>{const s=k.filter(i=>i.id!==e);s.length<k.length&&(k=s,bt(!1),x("Calcolo eliminato!"))};o?(o.classList.add("history-item-deleting"),o.addEventListener("animationend",d,{once:!0})):d()})},Qe=t=>{Ht(`Sei sicuro di voler eliminare tutti i calcoli per i pallini da ${t}?`,()=>{const e=document.querySelector(`.history-group[data-group-peso="${t}"]`),o=()=>{k=k.filter(d=>d.pesoOriginale.toFixed(2)!==t),delete rt[t],bt(!1),x("Gruppo di calcoli eliminato!")};e?(e.classList.add("history-item-deleting"),e.addEventListener("animationend",o,{once:!0})):o()})},We=t=>{const e=k.filter(l=>l.pesoOriginale.toFixed(2)===t);if(e.length===0){x("Nessun calcolo da copiare per questo gruppo.",!1);return}const o=e[0].unita.split(" ")[0],d=e[0].unita.split(" ")[2],s=e.reduce((l,u)=>l+u.joule,0)/e.length;let i=`--- Peso: ${t} ${o} (Media: ${s.toFixed(2)} J) ---
`;[...e].sort((l,u)=>u.data-l.data).forEach(l=>{const u=new Date(l.data),v=u.toLocaleDateString("it-IT"),M=u.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"});i+=`- ${v} ${M} | ${l.joule.toFixed(2)} J (${l.velocitaOriginale.toFixed(2)} ${d})
`}),i+=`
Copiato da Joule-Calc`,Fe(i,"Gruppo copiato negli appunti!")};function bt(t=!0){t?T=G:T=Math.max(G,T-1);const e=new Set;if(t&&k.length>0&&e.add(k[0].id),t){const o=document.getElementById("history-scroll-container");o&&o.scrollTop>0&&o.scrollTo({top:0,behavior:"smooth"})}q(st,k,!0,!0,{animatedItemIds:e}),q(At,k,!1,!1),Ke()}function to(t,e,o,d){const s=e.length,i=s-T;if(i<=0||T>=s)return;const r=Math.min(G,i),l=document.createElement("button");l.id="load-more-history",l.className="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition-colors duration-200",l.textContent=`Mostra altri ${r} (ne rimangono ${i})`,l.addEventListener("click",()=>{const u=T;T+=G;const v=new Set(e.slice(u,T).map(M=>M.id));q(t,e,o,d,{animatedItemIds:v})}),t.appendChild(l)}const q=(t=st,e=k,o=!0,d=!1,s={})=>{const{animatedItemIds:i=new Set}=s;if(t.innerHTML="",e.length===0){t.innerHTML='<div class="text-center text-gray-500 dark:text-gray-400 py-10">Lo storico dei calcoli apparirà qui.</div>',t===st&&qt.classList.add("hidden");return}const r=e.reduce((a,m)=>{const g=m.pesoOriginale.toFixed(2);return a[g]||(a[g]=[]),a[g].push(m),a},{}),l=Object.keys(r).sort((a,m)=>{const g=r[a].reduce((E,L)=>L.data>E?L.data:E,new Date(0));return r[m].reduce((E,L)=>L.data>E?L.data:E,new Date(0))-g}),u=l.flatMap(a=>{const m=r[a],g=rt[a]||"recent",B=[...m];switch(g){case"recent":B.sort((E,L)=>L.data-E.data);break;case"oldest":B.sort((E,L)=>E.data-L.data);break;case"joule-desc":B.sort((E,L)=>L.joule-L.joule);break;case"joule-asc":B.sort((E,L)=>E.joule-L.joule);break}return B}),M=(d?u.slice(0,T):u).reduce((a,m)=>{const g=m.pesoOriginale.toFixed(2);return a[g]||(a[g]=[]),a[g].push(m),a},{});if(l.forEach(a=>{if(!M[a])return;let m=M[a];const g=rt[a]||"recent",E=r[a].reduce((y,f)=>y+f.joule,0)/r[a].length,L=r[a][0].unita.split(" ")[0],$=document.createElement("div");$.className="history-group bg-gray-100 dark:bg-gray-700 p-4 rounded-lg shadow-sm",$.dataset.groupPeso=a;const A=document.createElement("div");A.className="flex flex-col sm:flex-row justify-between items-center mb-2 cursor-pointer",A.addEventListener("click",y=>{if(y.target.closest("select, button"))return;const f=`list-${a}-${t.id}`,I=document.getElementById(f),H=A.querySelector(".collapse-icon");I&&(Q[a]=!Q[a],I.classList.toggle("collapsed",Q[a]),H&&(H.style.transform=Q[a]?"rotate(-90deg)":"rotate(0deg)"))});const O=document.createElement("span");O.className="collapse-icon text-blue-800 dark:text-blue-200 transition-transform duration-300",O.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" /></svg>',O.style.transform=Q[a]?"rotate(-90deg)":"rotate(0deg)";const K=document.createElement("div");K.className="flex items-center gap-2 bg-blue-200 text-blue-800 dark:bg-blue-900 dark:text-blue-200 text-sm font-bold p-2 rounded-md text-center mb-2 sm:mb-0 w-full sm:w-auto justify-between";const X=document.createElement("span");X.className="flex items-center gap-2",X.textContent=`Media Joule (${a} ${L}): ${E.toFixed(2)} J`,X.prepend(O),K.appendChild(X),A.appendChild(K);const W=document.createElement("div");if(W.className="flex items-center gap-2",r[a].length>1){const y=document.createElement("select");y.id=`sort-${a}`,y.setAttribute("data-peso",a),y.className="block pl-3 pr-8 py-1 text-xs border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 rounded-md",y.innerHTML=`
                <option value="recent" ${g==="recent"?"selected":""}>Più recente</option>
                <option value="oldest" ${g==="oldest"?"selected":""}>Meno recente</option>
                <option value="joule-desc" ${g==="joule-desc"?"selected":""}>Joule (Max)</option>
                <option value="joule-asc" ${g==="joule-asc"?"selected":""}>Joule (Min)</option>
            `,y.addEventListener("change",H=>{rt[H.target.dataset.peso]=H.target.value,T=G,q(t,e,o,d)});const f=document.createElement("label");f.setAttribute("for",`sort-${a}`),f.className="text-sm text-gray-600 dark:text-gray-300",f.textContent="Ordina:";const I=document.createElement("div");I.className="flex items-center gap-2",I.appendChild(f),I.appendChild(y),W.appendChild(I)}if(o){const y=document.createElement("div");y.className="flex items-center";const f=document.createElement("button");f.className="text-blue-500 hover:text-blue-700 p-1 rounded-full transition-colors duration-200",f.setAttribute("data-action","copy-group"),f.setAttribute("data-peso",a),f.setAttribute("aria-label",`Copia tutti i calcoli per il peso ${a}`),f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>',y.appendChild(f);const I=document.createElement("button");I.className="text-red-500 hover:text-red-700 p-1 rounded-full transition-colors duration-200 ml-1",I.setAttribute("data-action","delete-group"),I.setAttribute("data-peso",a),I.setAttribute("aria-label",`Elimina tutti i calcoli per il peso ${a}`),I.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>',y.appendChild(I),K.appendChild(y)}A.appendChild(W),$.appendChild(A);const j=document.createElement("div");j.id=`list-${a}-${t.id}`,j.className="history-list space-y-2 pt-2",Q[a]&&j.classList.add("collapsed"),m.forEach(y=>{const f=document.createElement("div");f.className="history-item bg-gray-200 dark:bg-gray-600 p-3 rounded-md flex justify-between items-center",f.dataset.itemId=y.id,i.has(y.id)&&f.classList.add("history-item-animate");let I=o?`
                <button class="text-red-500 hover:text-red-700 p-1 rounded-full transition-colors duration-200" data-action="delete-single" data-id="${y.id}" aria-label="Elimina singolo calcolo">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>`:"";f.innerHTML=`
                <div>
                    <p class="text-sm font-medium dark:text-white">Joule: <span class="font-bold">${y.joule.toFixed(2)}</span></p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">${new Date(y.data).toLocaleString()}</p>
                </div>
                <div class="flex items-center gap-2">
                    <div class="text-right">
                        <p class="text-xs text-gray-700 dark:text-gray-300">Velocità: ${y.velocitaOriginale.toFixed(2)} ${y.unita.split(" ")[2]}</p>
                    </div>
                    ${I}
                </div>
            `,j.appendChild(f)}),$.appendChild(j),t.appendChild($)}),d&&to(t,u,o,d),t===st&&e.length>0){const a=Math.max(...e.map(g=>g.joule)),m=e.find(g=>g.joule===a);qt.classList.remove("hidden"),Le.innerHTML=`
            <p>
                Il risultato più alto è di <span class="font-bold text-lg">${a.toFixed(2)} J</span>,
                ottenuto con un pallino da <span class="font-bold">${m.pesoOriginale.toFixed(2)} ${m.unita.split(" ")[0]}</span>
                e una velocità di <span class="font-bold">${m.velocitaOriginale.toFixed(2)} ${m.unita.split(" ")[2]}</span>.
            </p>
            <p class="text-xs text-gray-600 dark:text-gray-400 mt-2">Registrato il: ${new Date(m.data).toLocaleString()}</p>
        `}},V=(t,e)=>{t.addEventListener("keydown",o=>{o.key==="Enter"&&(o.preventDefault(),typeof e=="function"?e():e&&e.focus())})},eo=()=>{const t=Nt();if(t.length===0){x("Lo storico è vuoto. Nessun dato da esportare.",!1);return}const o=[["Data","Ora","Peso","Unita Peso","Velocita","Unita Velocita","Joule"].join(",")],d=[...t].sort((v,M)=>v.data-M.data);for(const v of d){const M=new Date(v.data),a=M.toLocaleDateString("it-IT"),m=M.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),g=v.unita.split(" "),B=g[0],E=g[2],$=[a,m,v.pesoOriginale.toFixed(2),B,v.velocitaOriginale.toFixed(2),E,v.joule.toFixed(3)].map(A=>`"${String(A).replace(/"/g,'""')}"`);o.push($.join(","))}const s=o.join(`
`),i=new Blob([s],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(i),l=document.createElement("a"),u=new Date().toISOString().slice(0,10).replace(/-/g,"");l.setAttribute("href",r),l.setAttribute("download",`storico_joule_${u}.csv`),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(r),x("Esportazione CSV completata!")},ct=()=>{const t=Nt();if(t.length===0)return"Nessun calcolo nello storico da condividere.";let e=`I miei risultati:

`;const o=t.reduce((i,r)=>{const l=r.pesoOriginale.toFixed(2);return i[l]||(i[l]={unita:r.unita,calcoli:[]}),i[l].calcoli.push(r),i},{});Object.keys(o).sort((i,r)=>{const l=Math.max(...o[i].calcoli.map(v=>v.data.getTime()));return Math.max(...o[r].calcoli.map(v=>v.data.getTime()))-l}).forEach(i=>{const r=o[i],l=r.unita.split(" ")[0],u=r.unita.split(" ")[2],v=r.calcoli.reduce((a,m)=>a+m.joule,0)/r.calcoli.length;e+=`--- Peso: ${i} ${l} (Media: ${v.toFixed(2)} J) ---
`,[...r.calcoli].sort((a,m)=>m.data-a.data).forEach(a=>{const m=new Date(a.data),g=m.toLocaleDateString("it-IT"),B=m.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"});e+=`- ${g} ${B} | ${a.joule.toFixed(2)} J (${a.velocitaOriginale.toFixed(2)} ${u})
`}),e+=`
`});const s=t.reduce((i,r)=>r.joule>i.joule?r:i,t[0]);return e+=`--- Risultato Massimo ---
`,e+=`Il valore più alto registrato è ${s.joule.toFixed(2)} J con un pallino da ${s.pesoOriginale.toFixed(2)} ${s.unita.split(" ")[0]} a ${s.velocitaOriginale.toFixed(2)} ${s.unita.split(" ")[2]}.
`,e},Lt=t=>{navigator.clipboard.writeText(t).then(()=>{x("Storico copiato negli appunti!")}).catch(()=>{x("Errore durante la copia. Prova a selezionare e copiare manualmente.",!1)})},oe=t=>{const e=ct()+`

---
Generato da Joule-Calc: https://joule-calc.web.app/`;navigator.share?navigator.share({title:"Storico Calcoli Joule",text:e}).then(()=>x("Storico condiviso con successo!")).catch(o=>{o.name!=="AbortError"&&x("Condivisione annullata o fallita.",!1)}):x('La condivisione non è supportata. Usa il tasto "Copia".',!1)},oo=()=>{if(Nt().length===0){x("Lo storico è vuoto. Nessun dato da stampare.",!1);return}const e=ct().replace(/---/g,'<hr style="margin: 20px 0; border: 1px solid #ccc;">').replace(/\n/g,"<br>"),o=window.open("","_blank");o.document.write(`
        <html>
        <head>
            <title>Stampa Storico - Joule-Calc</title>
            <style>
                body { 
                    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
                    line-height: 1.6; 
                    color: #333;
                }
                h1 { 
                    text-align: center; 
                    border-bottom: 2px solid #eee; 
                    padding-bottom: 10px; 
                    margin-bottom: 20px;
                }
                hr {
                    border: 0;
                    border-top: 1px solid #ddd;
                    margin: 20px 0;
                }
                p { margin: 0; }
                .footer { 
                    margin-top: 30px; 
                    text-align: center; 
                    font-size: 0.8em; 
                    color: #777;
                }
            </style>
        </head>
        <body>
            <h1>Storico Calcoli Joule-Calc</h1>
            <p>${e}</p>
            <div class="footer">
                Generato da Joule-Calc: https://joule-calc.web.app/
            </div>
        </body>
        </html>
    `),o.document.close(),o.focus(),o.print()};function no(t,e,o){if(isNaN(t)||isNaN(e)||t<=0||e<=0)throw new Error("Valori di input non validi.");return o&&(t=t*ie,e=e*se),.5*(t/1e3)*(e*e)}function ao(t,e,o){if(isNaN(t)||isNaN(e)||t<=0||e<=0)throw new Error("Valori di input non validi.");let d;o?d=e*ie/1e3:d=e/1e3;const s=Math.sqrt(2*t/d),i=s/se;return{mps:s,fps:i}}function io(t){const{isMrad:e,distance:o,drop:d,drift:s,clickValue:i}=t;if(isNaN(o)||o<=0||d<=0&&s<=0)throw new Error("Distanza o deviazione non valide.");const r=l=>{if(l<=0)return{value:0,clicks:0};let u;e?u=l/(o/10):u=l/o*100/2.9089;const v=u/i;return{value:u,clicks:v}};return{elevation:r(d),windage:r(s)}}let Y=null;const at=t=>{Y||(Ot(t),Y=t,history.pushState({modalOpen:!0,modalId:t.id},""))},it=(t,e=!1)=>{!t||t.style.display==="none"||(z(t),Y=null,!e&&history.state&&history.state.modalOpen&&history.back())},yt="jouleCalcUnitSystem",ne=t=>{Re(t),localStorage.setItem(yt,t),document.querySelectorAll("[data-unit-selector]").forEach(o=>{o.querySelector('[data-unit-button="metrico"]').classList.toggle("active-unit",t==="metrico"),o.querySelector('[data-unit-button="imperiale"]').classList.toggle("active-unit",t==="imperiale")})},ae=t=>{Ve(t);const e=t==="dark"?"#111827":"#ffffff";document.querySelector('meta[name="theme-color"]').setAttribute("content",e)},re=()=>{const t=document.getElementById("appContainer"),e=document.getElementById("scroll-to-history-container"),o=document.querySelector(".tab-button.active");if(!t||!o)return;const d=o.id==="tab-joule";window.innerWidth<1024?(e&&e.classList.toggle("hidden",!d),t.style.overflowY=d?"scroll":"hidden"):(t.style.overflowY="",e&&e.classList.add("hidden"))},ht=(t,e,o=0)=>{const d=[_,St,Tt],s=d.findIndex(u=>!u.classList.contains("hidden")),i=d.indexOf(e);Ue(t);const r=document.getElementById("title-bar-tab-name");r&&(r.textContent=`- ${t.textContent}`),d.forEach(u=>u.classList.add("hidden")),e.classList.remove("hidden"),e.classList.remove("panel-slide-in-left","panel-slide-in-right");const l=o!==0?o:i>s?1:-1;setTimeout(()=>{e.classList.add(l>0?"panel-slide-in-right":"panel-slide-in-left")},10),re()},wt=t=>{t.classList.remove("result-animate"),t.offsetWidth,t.classList.add("result-animate")},$t=new Audio(ye);$t.preload="auto";const It=()=>{$t.currentTime=0,$t.play().catch(t=>{console.warn("La riproduzione del suono non è riuscita:",t)})},h=(t=10)=>{navigator&&"vibrate"in navigator&&window.navigator.vibrate&&navigator.vibrate(t)};document.addEventListener("DOMContentLoaded",()=>{Xe();const t=()=>{const n=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${n}px`)};window.addEventListener("resize",t),t();const e=document.getElementById("calculator-section"),o=document.getElementById("history-section"),d=document.getElementById("scroll-to-history-btn"),s=document.getElementById("scroll-to-calculator-btn");d&&o&&d.addEventListener("click",()=>{h(),o.scrollIntoView({behavior:"smooth"})}),s&&e&&s.addEventListener("click",()=>{h(),e.scrollIntoView({behavior:"smooth"})});const i=document.getElementById("scrollToHistoryTopBtn"),r=document.getElementById("history-scroll-container");i&&r&&(i.addEventListener("click",n=>{n.preventDefault(),h(),r.scrollTo({top:0,behavior:"smooth"})}),r.addEventListener("scroll",()=>{const n=r.scrollTop>50;i.classList.toggle("opacity-100",n),i.classList.toggle("pointer-events-auto",n),i.classList.toggle("opacity-0",!n),i.classList.toggle("pointer-events-none",!n)}));let l;const u=document.getElementById("installAppBtn"),v=document.getElementById("install-banner"),M=document.getElementById("installAppBtnBanner"),a=document.getElementById("closeInstallBannerBtn"),m="joule-calc-install-banner-dismissed-timestamp",g=7*24*60*60*1e3;if(u&&v&&M&&a){window.addEventListener("beforeinstallprompt",c=>{c.preventDefault(),l=c;const p=localStorage.getItem(m);!p||Date.now()-parseInt(p,10)>g?(v.classList.remove("hidden"),u.classList.add("hidden","opacity-0")):u.classList.remove("hidden","opacity-0"),console.log("`beforeinstallprompt` event was fired.")});const n=async()=>{l&&(h(),l.prompt(),u.classList.add("hidden"),v.classList.add("hidden"))};u.addEventListener("click",n),M.addEventListener("click",n),a.addEventListener("click",()=>{h(),v.classList.add("hidden"),localStorage.setItem(m,Date.now().toString()),u.classList.contains("hidden")&&(u.classList.remove("hidden"),setTimeout(()=>{u.classList.remove("opacity-0"),u.classList.add("animate-shake-subtle")},10),u.addEventListener("animationend",()=>{u.classList.remove("animate-shake-subtle")},{once:!0}))}),window.addEventListener("appinstalled",()=>{l=null,console.log("PWA was installed"),x("App installata con successo!",!0)})}dt.addEventListener("click",()=>{h();const n=parseFloat(U.value),c=parseFloat(D.value),p=(localStorage.getItem(yt)||"metrico")==="imperiale";try{const b=no(n,c,p);if(It(),F.innerHTML=`<span class="font-semibold">Energia in Joule:</span> <span id="joule-value" class="font-bold text-xl">${b.toFixed(2)}</span>`,F.classList.remove("hidden","bg-red-100","dark:bg-red-900"),wt(F),F.classList.add("bg-indigo-100","dark:bg-indigo-900"),qe())Gt.classList.remove("hidden"),x("Storico pieno! Il calcolo non è stato salvato.",!1);else{Gt.classList.add("hidden");const w={id:Date.now()+Math.random(),pesoOriginale:n,velocitaOriginale:c,unita:p?"gr e fps":"g e m/s",joule:b,data:new Date};Ge(w),x("Calcolo salvato nello storico!")}D.value="",document.activeElement&&document.activeElement.blur()}catch{F.innerHTML='<span class="font-semibold text-red-700 dark:text-red-200">Per favore, inserisci valori numerici validi.</span>',F.classList.remove("hidden","bg-indigo-100","dark:bg-indigo-900"),F.classList.add("bg-red-100","dark:bg-red-900"),x("Dati non validi!",!1)}}),document.body.addEventListener("click",n=>{const c=n.target.closest("[data-unit-button]");if(!c)return;const p=c.dataset.unitButton;(p==="metrico"||p==="imperiale")&&(h(),ne(p))});const B=[ft,Mt,Ct],E=[_,St,Tt];B.forEach((n,c)=>{n.addEventListener("click",()=>{h(),ht(B[c],E[c],0)})});let L=0,$=0;Xt.addEventListener("touchstart",n=>{L=n.changedTouches[0].screenX,$=n.changedTouches[0].screenY},{passive:!0}),Xt.addEventListener("touchend",n=>{const c=n.changedTouches[0].screenX,p=n.changedTouches[0].screenY,b=c-L,w=p-$;if(Math.abs(b)>50&&Math.abs(w)<75){const N=E.findIndex(Z=>!Z.classList.contains("hidden")),tt=b<0?1:-1,P=(N+tt+B.length)%B.length;h(),ht(B[P],E[P],tt)}},{passive:!0}),xe.addEventListener("click",()=>at(Kt)),Ee.addEventListener("click",()=>it(Kt)),we.addEventListener("click",()=>{h(20),ee()});const A=document.getElementById("exportBtn"),O=document.getElementById("exportModal"),K=document.getElementById("closeExportModalBtn"),X=document.getElementById("exportCsvBtnModal"),W=document.getElementById("exportTxtBtnModal"),j=document.getElementById("printBtnModal"),y=document.getElementById("shareBtnModal"),f=()=>{Y&&it(Y),z(ut),z(O)};A.addEventListener("click",()=>{h(),at(O)}),K.addEventListener("click",()=>it(O)),X.addEventListener("click",()=>{h(),eo(),f()}),W.addEventListener("click",()=>{h(),Lt(ct()+`

---
Generato da Joule-Calc: https://joule-calc.web.app/`),f()}),j.addEventListener("click",()=>{h(),oo(),f()}),y.addEventListener("click",()=>{h(),oe(),f()}),Ie.addEventListener("click",()=>{h(),Lt(ct()+`

---
Generato da Joule-Calc: https://joule-calc.web.app/`)}),ke.addEventListener("click",()=>{h(),oe()}),Be.addEventListener("click",()=>{q(At,void 0,!1),at(ut)});const I=document.getElementById("closeHistoryModalXBtn");I&&I.addEventListener("click",()=>it(ut));const H=document.getElementById("copyAllHistoryBtn");H&&H.addEventListener("click",()=>{h(),Lt(ct()+`

---
Generato da Joule-Calc: https://joule-calc.web.app/`)});const jt=document.getElementById("exportAllHistoryBtn");jt&&jt.addEventListener("click",()=>{h(),at(document.getElementById("exportModal"))});const Pt=document.getElementById("clearAllHistoryBtn");Pt&&Pt.addEventListener("click",()=>{h(20),ee(),z(ut)}),De.addEventListener("click",()=>z(Bt)),xt.addEventListener("click",()=>{h();const n=parseFloat(mt.value),c=parseFloat(et.value),p=(localStorage.getItem(yt)||"metrico")==="imperiale";try{const{mps:b,fps:w}=ao(n,c,p);It(),J.innerHTML=`
          <p class="font-semibold">Velocità necessaria:</p>
          <p><span class="font-bold text-xl">${b.toFixed(2)}</span> m/s</p>
          <p><span class="font-bold text-xl">${w.toFixed(2)}</span> fps</p>`,J.classList.remove("hidden","bg-red-100","dark:bg-red-900"),wt(J),J.classList.add("bg-teal-100","dark:bg-teal-900"),document.activeElement&&document.activeElement.blur()}catch{J.innerHTML='<span class="font-semibold text-red-700 dark:text-red-200">Per favore, inserisci valori numerici validi.</span>',J.classList.remove("hidden","bg-teal-100","dark:bg-teal-900"),J.classList.add("bg-red-100","dark:bg-red-900"),x("Dati non validi!",!1)}}),Et.addEventListener("click",()=>{h();try{const n={isMrad:vt.checked,distance:parseFloat(gt.value),drop:parseFloat(ot.value)||0,drift:parseFloat(nt.value)||0,dropDirection:document.getElementById("dropDirection").value,driftDirection:Oe.value,clickValue:parseFloat(lt.value)};if(isNaN(n.distance)||n.distance<=0||isNaN(n.drop)&&isNaN(n.drift))throw new Error("Dati di input non validi per il calcolo MOA.");const{elevation:c,windage:p}=io(n);It(),Vt(c,p,n),wt(R),document.activeElement&&document.activeElement.blur()}catch{R.innerHTML='<span class="font-semibold text-red-700 dark:text-red-200">Inserisci distanza e almeno un valore di deviazione validi.</span>',R.classList.remove("hidden","bg-purple-100","dark:bg-purple-900"),R.classList.add("bg-red-100","dark:bg-red-900"),x("Dati non validi!",!1)}}),vt.addEventListener("change",()=>{h(),te()}),[U,D,mt,et,gt,ot,nt].forEach(n=>{n.addEventListener("focus",c=>c.target.select())}),V(U,D),V(D,()=>dt.click()),V(mt,et),V(et,()=>xt.click()),V(gt,ot),V(ot,nt),V(nt,()=>Et.click()),document.addEventListener("click",n=>{const c=n.target.closest("[data-action]");if(c){(c.dataset.action==="copy-group"||c.dataset.action==="delete-group")&&(c.classList.add("animate-shake-subtle"),c.addEventListener("animationend",()=>{c.classList.remove("animate-shake-subtle")},{once:!0}));const{action:b,id:w,peso:S}=c.dataset;b==="copy-group"?(h(),We(S)):b==="delete-single"?Ze(w):b==="delete-group"&&Qe(S);return}const p=n.target.closest("[data-help-topic]");p&&(ze(p.dataset.helpTopic),at(Bt))}),Ce.addEventListener("click",()=>{h(20),z(kt);const n=Je();n&&n(),Qt()},{passive:!0}),Te.addEventListener("click",()=>{h(),z(kt),Qt()},{passive:!0}),be.addEventListener("click",()=>{h();const c=Wt()==="dark"?"light":"dark";localStorage.setItem("theme",c),ae(c)},{passive:!0}),ae(Wt()),te();const ce=localStorage.getItem(yt)||"metrico";ne(ce);const de={isMrad:vt.checked,dropDirection:"Down",driftDirection:"Right"};Vt({value:0,clicks:0},{value:0,clicks:0},de),window.addEventListener("popstate",n=>{var c;Y&&((c=n.state)==null?void 0:c.modalOpen)!==!0&&it(Y,!0)});const Ft=()=>{const n=window.location.hash.substring(1),c={joule:{tab:ft,panel:_},velocity:{tab:Mt,panel:St},compensation:{tab:Ct,panel:Tt}};if(n&&c[n]){const{tab:p,panel:b}=c[n];p&&b&&ht(p,b)}};Ft(),window.addEventListener("hashchange",Ft),(()=>{const n=new URLSearchParams(window.location.search),c=n.get("title"),p=n.get("text"),b=n.get("shared_url");if(p||c||b){console.log("Dati condivisi ricevuti:",{sharedTitle:c,sharedText:p,sharedUrl:b}),x(`Contenuto condiviso: ${p||c}`),window.history.replaceState({},document.title,"/");return}const w=n.get("url");if(w){console.log("App avviata tramite protocollo:",w);try{const S=new URL(w),{searchParams:C,pathname:N}=S;if(N.replace(/^\/*/,"")==="calculate"&&C.has("weight")&&C.has("velocity")){const P=parseFloat(C.get("weight")),Z=parseFloat(C.get("velocity"));!isNaN(P)&&!isNaN(Z)&&(ht(ft,_),U.value=P,D.value=Z,dt.click(),x("Dati dal link caricati!"))}}catch(S){console.error("Errore nel parsing dell'URL del protocollo:",S),x(`Link personalizzato non valido: ${w}`,!1)}window.history.replaceState({},document.title,"/")}})();const ue=n=>{setTimeout(()=>{n&&n.scrollIntoView({behavior:"smooth",block:"nearest"})},300)};[{inputs:[U,D],button:dt},{inputs:[mt,et],button:xt},{inputs:[gt,ot,nt],button:Et}].forEach(({inputs:n,button:c})=>{n.forEach(p=>{p&&p.addEventListener("focus",()=>ue(c))})});let Jt;window.addEventListener("resize",()=>{clearTimeout(Jt),Jt=setTimeout(re,100)});const Rt=n=>{n.querySelectorAll(".bg-gray-100.dark\\:bg-gray-700.p-4").forEach(p=>{p.querySelectorAll(".bg-gray-200.dark\\:bg-gray-600.p-3").forEach(w=>{if(w.classList.contains("flex-col"))return;w.classList.remove("justify-between","items-center"),w.classList.add("flex-col","sm:flex-row","sm:justify-between","items-start","sm:items-center","gap-2");const S=w.querySelector(".text-right");S&&(S.classList.remove("text-right"),S.classList.add("text-left","sm:text-right"));const[C,N]=w.children;C&&N&&(C.classList.add("w-full","sm:w-auto"),N.classList.add("w-full","sm:w-auto","flex","justify-between","items-center"))})})};new MutationObserver(()=>Rt(_)).observe(_,{childList:!0,subtree:!0}),Rt(_);function Vt(n,c,p){const{isMrad:b,driftDirection:w,dropDirection:S}=p,C=b?"MRAD":"MOA",N='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="inline-block w-4 h-4 mr-1 align-text-bottom"><path fill-rule="evenodd" d="M10 17a.75.75 0 0 1-.75-.75V5.56l-2.72 2.72a.75.75 0 0 1-1.06-1.06l4.25-4.25a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1-1.06 1.06L10.75 5.56v10.69a.75.75 0 0 1-.75.75Z" clip-rule="evenodd" /></svg>',tt='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="inline-block w-4 h-4 mr-1 align-text-bottom"><path fill-rule="evenodd" d="M10 3a.75.75 0 0 1 .75.75v10.69l2.72-2.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 12.78a.75.75 0 1 1 1.06-1.06l2.72 2.72V3.75A.75.75 0 0 1 10 3Z" clip-rule="evenodd" /></svg>',P='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="inline-block w-4 h-4 mr-1 align-text-bottom"><path fill-rule="evenodd" d="M17 10a.75.75 0 0 1-.75.75H5.56l2.72 2.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 1 1 1.06 1.06L5.56 9.25H16.25A.75.75 0 0 1 17 10Z" clip-rule="evenodd" /></svg>',Z='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="inline-block w-4 h-4 mr-1 align-text-bottom"><path fill-rule="evenodd" d="M3 10a.75.75 0 0 1 .75-.75h10.69l-2.72-2.72a.75.75 0 1 1 1.06-1.06l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 1 1-1.06-1.06L14.44 10.75H3.75A.75.75 0 0 1 3 10Z" clip-rule="evenodd" /></svg>',_t=S==="Down"?"ALZA":"ABBASSA",pe=_t==="ALZA"?N:tt,zt=w==="Right"?"SINISTRA":"DESTRA",me=zt==="SINISTRA"?P:Z,ge=n.clicks>=0?`<div class="p-3 bg-purple-200/50 dark:bg-gray-800/50 rounded-lg shadow-inner"><p class="text-sm font-medium text-gray-600 dark:text-gray-300">${pe}Alzo</p><p class="text-2xl font-bold text-purple-800 dark:text-purple-300 my-1">${n.clicks.toFixed(0)} Clicks</p><p class="text-sm text-gray-700 dark:text-gray-400">(${n.value.toFixed(1)} ${C})</p><p class="text-xs font-semibold text-gray-500 dark:text-gray-300 mt-2">${_t}</p></div>`:"",he=c.clicks>=0?`<div class="p-3 bg-purple-200/50 dark:bg-gray-800/50 rounded-lg shadow-inner"><p class="text-sm font-medium text-gray-600 dark:text-gray-300">${me}Deriva</p><p class="text-2xl font-bold text-purple-800 dark:text-purple-300 my-1">${c.clicks.toFixed(0)} Clicks</p><p class="text-sm text-gray-700 dark:text-gray-400">(${c.value.toFixed(1)} ${C})</p><p class="text-xs font-semibold text-gray-500 dark:text-gray-300 mt-2">VERSO ${zt}</p></div>`:"",fe=n.clicks>0||c.clicks>0?`<p class="text-xs text-gray-500 dark:text-gray-400 mt-4 text-center">(Click: ${lt.options[lt.selectedIndex].text.replace(" per Click","")})</p>`:"",ve=`<div class="grid grid-cols-2 gap-4 text-center">${ge}${he}</div>${fe}`;R.innerHTML=ve,R.classList.remove("hidden","bg-red-100","dark:bg-red-900"),R.classList.add("bg-purple-100","dark:bg-purple-900")}});
